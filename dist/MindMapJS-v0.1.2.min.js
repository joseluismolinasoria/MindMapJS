/*! MindMapJS v0.1.2 2014-07-04 Por José Luis Molina Soria */
!function(){Kinetic.Beizer=function(a){this.___init(a)},Kinetic.Beizer.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Beizer"},drawFunc:function(a){var b=a.getContext(),c=this.attrs.puntos;b.beginPath(),b.moveTo(c.start.x,c.start.y),b.bezierCurveTo(c.control1.x,c.control1.y,c.control2.x,c.control2.y,c.end.x,c.end.y),a.stroke(this)}},Kinetic.Util.extend(Kinetic.Beizer,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Beizer,"puntos",0)}();var MM={};if("undefined"!=typeof module&&(module.exports=MM),MM.Properties={},MM.Properties.add=function(a,b){var c={};for(var d in a)c[d]=a[d];for(d in b)c[d]=b[d];return c},Function.prototype.chain=function(){var a=this;return function(){var b=a.apply(this,arguments);return void 0===b?this:b}},Function.prototype.processable=function(a,b){var c=this;return function(){var d;a&&a.apply(this,arguments);var e=c.apply(this,arguments);return b&&(d=b.apply(this,arguments)),void 0===d?e:d}},"undefined"!=typeof module&&(module.exports=Function.prototype.procesable),"undefined"!=typeof module)var MM=require("./MindMapJS.js");if(MM.Class=function(){this.init=function(){}},MM.Class.extend=function(a){function b(){}function c(){this.init&&this.init.apply(this,arguments)}var d=this.prototype||MM.Class.prototype;b.prototype=d;var e=new b,f=function(a,b){return function(){var c=this._super;this._super=d[a];var e=b.apply(this,arguments);return this._super=c,e}};for(var g in a)e[g]="function"==typeof a[g]&&"function"==typeof d[g]?f(g,a[g]):a[g];return c.prototype=e,c.prototype.constructor=c,c.extend=this.extend,c},MM.Class.bind=function(a,b){return function(){return b.apply(a,arguments)}},"undefined"!=typeof module&&(module.exports=MM.Class),"undefined"!=typeof module){var MM=require("./MindMapJS.js");MM.Class=require("./klass.js")}if(MM.PubSub=MM.Class.extend({eventos:{},idSus:1,init:function(){this.eventos={},this.idSus=1},on:function(a){if(!this.eventos[a])return!1;var b=Array.prototype.slice.call(arguments,1);return this.eventos[a].forEach(function(a){a.funcion.apply(a.contexto,b)}),b=null,!0},suscribir:function(a,b,c){return a&&b?(this.eventos[a]||(this.eventos[a]=[]),c=c||this,this.eventos[a].push({id:this.idSus,contexto:c,funcion:b}),this.idSus++):null},desSuscribir:function(a){for(var b in this.eventos)if(this.eventos[b])for(var c=0,d=this.eventos[b].length;d>c;c++)if(this.eventos[b][c].id===a)return this.eventos[b].splice(c,1),a;return null}}),"undefined"!=typeof module&&(module.exports=MM.PubSub),"undefined"!=typeof module){var MM=require("./MindMapJS.js");MM.PubSub=require("./pubsub.js")}MM.Arbol=MM.PubSub.extend({init:function(a,b){this.elemento=a,this.hijos=b||[]}}),MM.Arbol.prototype.preOrden=function(){this.on("preOrden",this);var a=[this.elemento];return this.hijos.forEach(function(b){a=a.concat(b.preOrden())}),this.on("postPreOrden",this),a},MM.Arbol.prototype.generalPreOrden=function(a,b){this.on("preOrden",this);var c=a(this.elemento);return this.hijos.forEach(function(d){b(c,d.generalPreOrden(a,b))}),this.on("postPreOrden",this),c},MM.Arbol.prototype.inOrden=function(){if(0===this.ordenNodo())return[this.elemento];var a=[];return this.hijos.forEach(function(b,c){a=a.concat(b.inOrden()),0===c&&(a=a.concat(this.elemento),this.on("inOrden",this))},this),this.on("postInOrden",this),a},MM.Arbol.prototype.postOrden=function(){var a=[];return this.hijos.forEach(function(b){a=a.concat(b.postOrden())}),this.on("postOrden",this),a.concat(this.elemento)},MM.Arbol.prototype.ordenNodo=function(){return this.hijos.length},MM.Arbol.prototype.orden=function(){var a=this.hijos.map(function(a){return a.orden()});return a.push(this.ordenNodo()),Math.max.apply(null,a)},MM.Arbol.prototype.peso=function(){var a=1;return this.hijos.forEach(function(b){a+=b.peso()}),a},MM.Arbol.prototype.altura=function(){var a=0;return this.hijos.forEach(function(b){a=Math.max(a,b.altura())}),a+1},MM.Arbol.prototype.esHoja=function(){return 0===this.hijos.length},MM.Arbol.prototype.numHojas=function(){if(this.esHoja())return this.on("enHoja",this),1;var a=0;return this.hijos.forEach(function(b){a+=b.numHojas()}),a},MM.Arbol.prototype.elementEqual=function(a){return a===this.elemento},MM.Arbol.prototype.buscar=function(a){if(this.elementEqual(a))return this;var b=null;return this.hijos.forEach(function(c){var d=c.buscar(a);null!==d&&(b=d),d=null}),b},MM.Arbol.prototype.profundidad=function(a){if(this.elementEqual(a))return 0;var b=-1;return this.hijos.forEach(function(c){var d=c.profundidad(a);-1!==d&&(b=d+1)}),b},MM.Arbol.prototype.padreDe=function(a){if(this.elementEqual(a))return null;var b=!1;return this.hijos.forEach(function(c){c.elementEqual(a)&&(b=this)},this),b?this:(b=null,this.hijos.forEach(function(c){null===b&&(b=c.padreDe(a))}),b)},MM.Arbol.prototype.borrar=function(a){var b=this.padreDe(a),c=null;if(null!==b)for(var d=0;d<=b.hijos.length;d++)if(b.hijos[d].elementEqual(a)){c=b.hijos[d],b.hijos.splice(d,1);break}return b=null,c};var ArbolN=function(a){var b=Array.prototype.slice.call(arguments,1);return new MM.Arbol(a,b)};if("undefined"!=typeof module&&(module.exports.ArbolN=ArbolN,module.exports.Arbol=MM.Arbol),MM.DOM={},MM.DOM.create=function(a,b){var c=window.document.createElement(a);for(var d in b)"innerHTML"===d?c[d]=b[d]:c.setAttribute(d,b[d]);return c.remove=function(){this.parentNode.removeChild(this)},c},"undefined"!=typeof module)var MM=require("./MindMapJS.js");if(MM.teclado={},MM.teclado.tecla={f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,shift:16,ctrl:17,alt:18,leftMeta:91,rightMeta:92,scrolllock:145,numlock:144,capslock:20,pageup:33,pagedown:34,left:37,up:38,right:39,down:40,ins:45,home:36,del:46,end:35,backspace:8,tab:9,enter:13,esc:27,escape:27,space:32},MM.teclado.tecla.excepciones={171:"+",56:"+",221:"+",107:"+",173:"-",189:"-",191:"-",109:"-",96:"0"},MM.teclado.keyDown=function(a){if(!MM.teclado.atajos.activo)return!0;var b=a?a:window.event,c=window.Event?b.which:b.keyCode,d=MM.teclado.tecla.nombre(c,b);if(MM.teclado.tecla.esModificador(c))return b=c=d=null,!0;var e=MM.teclado.atajos.calcular(d,b),f=MM.teclado.atajos.definidos[e];return f&&f.activo?(b.preventDefault(),b.stopPropagation(),MM.teclado.atajos.lanzar(e),f=b=c=d=e=null,!1):(f=b=c=d=e=null,!0)},MM.teclado.tecla.nombre=function(a){if(this.excepciones[a])return this.excepciones[a];for(var b in this)if(a===this[b])return b;return String.fromCharCode(a)},MM.teclado.tecla.valor=function(a){return this[a]},MM.teclado.tecla.esModificador=function(a){return a===this.ctrl||a===this.alt||a===this.shift||a===this.leftMeta||a===this.rightMeta},MM.teclado.tecla.esControl=function(a){return a===this.ctrl},MM.teclado.tecla.esAlt=function(a){return a===this.alt},MM.teclado.tecla.esShift=function(a){return a===this.shift},MM.teclado.tecla.esMeta=function(a){return a===this.leftMeta||a===this.rightMeta},MM.teclado.atajos={activo:!0,definidos:{},ctrl:!1,shift:!1,alt:!1,window:!1},MM.teclado.atajos.add=function(a,b,c){this.definidos[a]={funcion:b,contexto:c||this,activo:!0}},MM.teclado.atajos.calcular=function(a,b){var c=new RegExp("\\+"+a+"$","i"),d=/ctrl\+/i,e=/alt\+/i,f=/shift\+/i,g=/meta\+/i;for(var h in this.definidos){if(a===h)return h;if(c.test(h)&&(b.ctrlKey?d.test(h):!d.test(h))&&(b.altKey||b.altGraphKey?e.test(h):!e.test(h))&&(b.shiftKey?f.test(h):!f.test(h))&&(b.metaKey?g.test(h):!g.test(h)))return h}return c=d=e=f=g=null,null},MM.teclado.atajos.lanzar=function(a){var b=this.definidos[a];b&&b.funcion.apply(b.contexto,[]),b=null},MM.teclado.atajos.activar=function(a,b){var c=this.definidos[a];c&&(c.activo=b),c=null},"undefined"!=typeof module&&(module.exports=MM.teclado),window&&window.addEventListener("keydown",MM.teclado.keyDown,!0),"undefined"!=typeof module){var MM=require("./MindMapJS.js");MM.Class=require("./pubsub.js")}if(MM.importar=function(){var a=new MM.PubSub,b=function(a,b){if(a){var c=new FileReader;c.onloadstart=d,c.onprogress=g,c.onload=h,c.onabort=f,c.onerror=i,c.onloadend=e,c.readAsText(a,b||"UTF-8")}},c=function(a){if(a){var b=new FileReader;b.onloadstart=d,b.onprogress=g,b.onload=h,b.onabort=f,b.onerror=i,b.onloadend=e,b.readAsDataURL(a)}},d=function(b){a.on("inicio",b)},e=function(b){a.on("fin",b)},f=function(b){a.on("abortado",b)},g=function(b){if(b.lengthComputable){var c=b.loaded/b.total*100;100>c&&a.on("progreso",c,b)}},h=function(b){a.on("cargado",b.target.result,b)},i=function(b){"NotFoundError"!==b.target.error.name&&("SecurityError"===b.target.error.name&&a.on("error/seguridad",b),"NotReadableError"===b.target.error.name&&a.on("error/lectura",b),"EncodingError"===b.target.error.name&&a.on("error/encoding",b))};return{evento:a,texto:b,dataURL:c}}(),MM.importar.XML=function(){var a=MM.Class.extend({cargar:function(a,c){this.idSusCargado=MM.importar.evento.suscribir("cargado",b,this),this.idSusErrorSeg=MM.importar.evento.suscribir("error/seguridad",d,this),this.idSusErrorLec=MM.importar.evento.suscribir("error/lectura",d,this),this.idSusErrorEnc=MM.importar.evento.suscribir("error/encoding",d,this),MM.importar.texto(a,c)}}),b=function(a){var b=e(a);MM.importar.evento.on("xml/parseado",b);var d=c(b.documentElement);MM.importar.evento.on("xml/procesado",d),MM.importar.evento.desSuscribir(this.idSusCargado),MM.importar.evento.desSuscribir(this.idSusErrorSeg),MM.importar.evento.desSuscribir(this.idSusErrorLec),MM.importar.evento.desSuscribir(this.idSusErrorEnc)},c=function(a){var b,d={nombre:a.nodeName,hijos:[]};if(a.attributes)for(b=0;b<a.attributes.length;b++)d[a.attributes[b].name]=a.attributes[b].value;if(a.childNodes)for(b=0;b<a.childNodes.length;b++)3===a.childNodes[b].nodeType?d.texto=a.childNodes[b].nodeValue:1===a.childNodes[b].nodeType&&d.hijos.push(c(a.childNodes[b]));return b=null,d},d=function(a){console.log(a)},e=function(a){var b,c;return window.DOMParser?(c=new DOMParser,b=c.parseFromString(a,"text/xml")):(b=new ActiveXObject("Microsoft.XMLDOM"),b.async=!1,b.loadXML(a)),c=null,b};return a}(),MM.importar.FreeMind=function(){var a=MM.importar.XML.extend({cargar:function(a,c){this.idSus=MM.importar.evento.suscribir("xml/procesado",b,this),this._super(a,c)}}),b=function(a){if("map"!==a.nombre||1!==a.hijos.length)return void MM.importar.evento.on("freeMind/error","No se trata de un fichero FreeMind válido");var b=a.hijos[0];MM.nuevo(b.TEXT||b.text),MM.importar.evento.on("freeMind/raiz",b.TEXT||b.text),d(b),MM.importar.evento.on("freeMind/procesado"),MM.importar.evento.desSuscribir(this.idSus),b=null},c=function(a){MM.add(a.TEXT||a.text).next().lastHermano();d(a),MM.padre()},d=function(a){for(var b=0;b<a.hijos.length;b++)"node"===a.hijos[b].nombre&&c(a.hijos[b]);b=null};return a}(),"undefined"!=typeof module&&(module.exports=MM.importar),"undefined"!=typeof module){var MM=require("./MindMapJS.js");MM.Class=require("./klass.js"),MM.PubSub=require("./pubsub.js")}if(MM.exportar={},MM.exportar.freemind=function(){var a=function(){for(var a=MM.DOM.create("div"),d=MM.DOM.create("map",{version:"0.9.0"}),e=MM.arbol.generalPreOrden(b,c),f=0;f<e.length;f++)d.appendChild(e[f]);return a.appendChild(d),a.innerHTML},b=function(a){var b=(new Date).getTime(),c=MM.DOM.create("node",{BACKGROUND_COLOR:MM.color.rgbToHexCSS(MM.color.hslToRgb(MM.color.addBrillo(a.nodo.hslColor,40))),COLOR:MM.color.rgbToHexCSS(MM.color.hslToRgb(a.nodo.hslColor)),CREATE:b,ID:"ID_"+Math.floor(1e11*Math.random()+1),MODIFIED:b,STYLE:"bubble",FOLDED:a.plegado,TEXT:a.texto}),d=MM.DOM.create("edge",{STYLE:"bezier",COLOR:MM.color.rgbToHexCSS(MM.color.hslToRgb(a.nodo.hslColor))});return c.appendChild(d),b=null,[c]},c=function(a,b){for(var c=0;c<b.length;c++)a[0].appendChild(b[c]);c=null},d=function(){window.URL=window.URL||window.webkitURL,window.URL||alert("Operación no soportada por su navegador");var b=new Blob([a()],{type:"application/xml"}),c=window.document.createElement("a");c.download=MM.arbol.elemento.texto+".mm",c.href=window.URL.createObjectURL(b);var d=document.createEvent("MouseEvents");d.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),c.dispatchEvent(d)};return{grabar:d}}(),MM.Grid=MM.Class.extend({init:function(a,b,c){this.capa=a,this.width=b,this.height=c,this.render()},render:function(){for(var a=-2*this.width,b=2*this.width,c=-2*this.height,d=2*this.height,e=a;e<=2*this.width;e+=100)this.capa.add(new Kinetic.Line({points:[e,c,e,d],stroke:"grey",strokeWidth:1,lineCap:"round",lineJoin:"round",dashArray:[.8,5]}));for(var f=-2*this.height;f<=2*this.height;f+=100)this.capa.add(new Kinetic.Line({points:[a,f,b,f],stroke:"grey",strokeWidth:1,lineCap:"round",lineJoin:"round",dashArray:[.8,5]}));e=f=a=b=c=d=null}}),MM.Borde=MM.Class.extend({init:function(a,b,c){this.capa=a,this.width=b,this.height=c,this.render()},render:function(){this.capa.add(new Kinetic.Line({points:[0,0,this.width,0],stroke:"grey",strokeWidth:1,lineCap:"round",lineJoin:"round",dashArray:[4,3]})),this.capa.add(new Kinetic.Line({points:[0,0,0,this.height],stroke:"grey",strokeWidth:1,lineCap:"round",lineJoin:"round",dashArray:[4,3]})),this.capa.add(new Kinetic.Line({points:[0,this.height,this.width,this.height],stroke:"grey",strokeWidth:1,lineCap:"round",lineJoin:"round",dashArray:[4,3]})),this.capa.add(new Kinetic.Line({points:[this.width,0,this.width,this.height],stroke:"grey",strokeWidth:1,lineCap:"round",lineJoin:"round",dashArray:[4,3]}))}}),MM.Mensaje=MM.Class.extend({defecto:{x:5,y:5,text:"",fontSize:14,fontFamily:"helvetica",fill:"#555",width:"auto",align:"center"},init:function(a,b,c){this.escenario=a,this.capa=b;var d=MM.Properties.add(this.defecto,c);this.kText=new Kinetic.Text(d),b.add(this.kText)},setText:function(a){this.kText.setText(a),this.capa.draw()},getText:function(){return this.kText.getText()},setX:function(a){this.kText.setX(a),this.capa.draw()},getX:function(){return this.kText.getAbsolutePosition().x},setY:function(a){this.kText.setY(a),this.capa.draw()},getY:function(){return this.kText.getAbsolutePosition().y},getWidth:function(){return this.kText.getWidth()},getHeight:function(){return this.kText.getHeight()}}),MM.Arista=MM.Class.extend({init:function(a,b,c,d){this.capa=a,this.elementoOrigen=b,this.elementoDestino=c,this.context=a.getCanvas().getContext(),this.tamano=d,this.render()},calcularPuntos:function(){var a=this.elementoOrigen.nodo,b=this.elementoDestino.nodo;this.x1=a.getX()+a.getWidth()-5,this.y1=a.getY()+a.getHeight()/2,this.x2=b.getX()+5,this.y2=b.getY()+b.getHeight()/2,this.c1x=this.x1+(this.x2-this.x1)/2,this.c1y=this.y1,this.c2x=this.x1+(this.x2-this.x1)/2,this.c2y=this.y2,a=b=null},render:function(){this.calcularPuntos(),this.beizer=new Kinetic.Beizer({stroke:"#555",strokeWidth:this.tamano,puntos:{start:{x:this.x1,y:this.y1},end:{x:this.x2,y:this.y2},control1:{x:this.c1x,y:this.c1y},control2:{x:this.c2x,y:this.c2y}}}),this.capa.add(this.beizer)},redraw:function(){this.elementoOrigen.plegado?this.beizer.setVisible(!1):(this.calcularPuntos(),this.beizer.setVisible(!0),this.beizer.setPuntos({start:{x:this.x1,y:this.y1},end:{x:this.x2,y:this.y2},control1:{x:this.c1x,y:this.c1y},control2:{x:this.c2x,y:this.c2y}}))},destroy:function(){this.beizer.destroy(),delete this.beizer,delete this.capa,delete this.elementoOrigen,delete this.elementoDestino}}),MM.Rama=MM.Arista.extend({init:function(a,b,c,d){this._super(a,b,c,d)},calcularPuntos:function(){var a=this.elementoOrigen.nodo,b=this.elementoDestino.nodo;this.x1=(a.getX()+MM.render.offset.x+a.getWidth())*MM.render.getEscala(),this.y1=(a.getY()+MM.render.offset.y+a.getHeight())*MM.render.getEscala(),this.x2=b.getX()+MM.render.offset.x*MM.render.getEscala(),this.y2=(b.getY()+MM.render.offset.y+b.getHeight())*MM.render.getEscala(),this.x3=(b.getX()+MM.render.offset.x+b.getWidth())*MM.render.getEscala(),this.y3=(b.getY()+MM.render.offset.x+b.getHeight())*MM.render.getEscala(),this.c1x=this.x1+(this.x2-this.x1)/2,this.c1y=this.y1,this.c2x=this.x1+(this.x2-this.x1)/2,this.c2y=this.y2,a=b=null},render:function(){var a=this.context;this.calcularPuntos(),a.beginPath(),a.moveTo(this.x1,this.y1),a.bezierCurveTo(this.c1x,this.c1y,this.c2x,this.c2y,this.x2,this.y2),a.strokeStyle=this.elementoOrigen.nodo.color,a.lineWidth=this.tamano*MM.render.getEscala(),a.lineTo(this.x3,this.y3),a.stroke(),a.beginPath(),a.moveTo(this.x2,this.y2),a.strokeStyle=this.elementoDestino.nodo.color,a.lineWidth=this.tamano*MM.render.getEscala(),a.lineTo(this.x3,this.y3),a.stroke(),a=null}}),MM.NodoSimple=MM.Mensaje.extend({defecto:{x:0,y:0,text:"",fontSize:13,fontFamily:"helvetica",fill:"#555",width:"auto",padding:5},init:function(a,b,c){this.render=a,this.escenario=a.escenario,this.capa=a.capaNodos,this.arbol=b,this.hslColor=MM.color.randomHslColor(),this.colorFondo=MM.color.hslToCSS(this.hslColor,40),this.color=MM.color.hslToCSS(this.hslColor),this.aristas=[];var d=MM.Properties.add(this.defecto,c);d.x=0,d.y=0,d.fill=this.color,this.kText=new Kinetic.Text(d),this.group=new Kinetic.Group({x:c.x,y:c.y,width:this.kText.getWidth(),height:this.kText.getHeight(),draggable:!0,dragBoundFunc:function(a){return console.debug("drag Nodo"),MM.ponerFoco(b),MM.render.renderAristas(),a}});var e=this.kText.getWidth(),f=this.kText.getHeight();this.rect=new Kinetic.Blob({points:[{x:0,y:0},{x:e+17,y:0},{x:e+17,y:f},{x:0,y:f}],stroke:this.color,strokeWidth:2,fill:this.colorFondo,shadowColor:this.color,shadowBlur:4,shadowOffset:{x:4,y:4},shadowOpacity:.7,tension:.3});var g=10,h=e+5,i=(f-g)/2,j=this.arbol.elemento.plegado?[h,i,h+g,i,h+.5*g,i+g]:[h,i,h,i+g,h+g,i+.5*g];this.triangle=new Kinetic.Polygon({points:j,fill:this.color,visible:!this.arbol.esHoja()}),this.triangle.on("mouseover",MM.Class.bind(this,function(){MM.render.contenedor.style.cursor="pointer",this.arbol.elemento.plegado?MM.render.contenedor.setAttribute("title","desplegar"):MM.render.contenedor.setAttribute("title","plegar")})),this.triangle.on("mouseout",MM.Class.bind(this,function(){MM.render.contenedor.style.cursor="default",MM.render.contenedor.setAttribute("title","")}));var k=MM.Class.bind(this,function(a){MM.render.contenedor.style.cursor="default",MM.render.contenedor.setAttribute("title",""),MM.ponerFoco(this.arbol),MM.plegarRama(!this.arbol.elemento.plegado),a.cancelBubble=!0});this.triangle.on("click",k),this.triangle.on("tap",k),this.line=new Kinetic.Line({points:[{x:0,y:this.kText.getHeight()},{x:this.kText.getWidth(),y:this.kText.getHeight()}],stroke:this.color,strokeWidth:3,lineCap:"round",lineJoin:"round"}),this.group.add(this.rect),this.group.add(this.triangle),this.group.add(this.line),this.group.add(this.kText),this.capa.add(this.group),this.rect.hide();var l=MM.Class.bind(MM.render,MM.render.editar),m=(MM.Class.bind(this,this.nop),MM.Class.bind(this,function(){MM.ponerFoco(this.arbol)}));this.group.on("click",m),this.group.on("tap",m),this.group.on("dblclick",l),this.group.on("dbltap",l),f=e=g=h=i=null},ponerFoco:function(){this.kText.setFontStyle("bold"),this.kText.setText("<"+this.arbol.elemento.texto+">"),this.group.draw()},quitarFoco:function(){this.kText.setFontStyle("normal"),this.kText.setLineHeight(1),this.kText.setText(this.arbol.elemento.texto),this.group.draw()},setVisible:function(a){var b=this.kText.getWidth(),c=this.kText.getHeight(),d=10,e=b+5,f=(c-d)/2;this.triangle.setPoints(this.arbol.elemento.plegado?[e,f,e+d,f,e+.5*d,f+d]:[e,f,e,f+d,e+d,f+.5*d]),this.triangle.setVisible(!this.arbol.esHoja()),this.group.setVisible(a)},setX:function(a){this.group.setX(a)},getX:function(){return this.group.getX()},setY:function(a){this.group.setY(a)},getY:function(){return this.group.getY()},getGroup:function(){return this.group},getWidth:function(){return this.group.getWidth()},getHeight:function(){return this.group.getHeight()},editar:function(){var a=this.getText(),b=this.calcularFilasColumnas(a),c=this.getY()*MM.render.getEscala()+MM.render.offset.y-5,d=this.getX()*MM.render.getEscala()+MM.render.offset.x-5;this.editor=new MM.DOM.create("textarea",{id:"editNodo",innerHTML:a,rows:b.filas,cols:b.columnas+1,style:"position: absolute; top : "+c+"px; left: "+d+"px; height: auto;border: 3px solid "+this.color+"; border-radius: 5px;background-color: "+this.colorFondo+"; color: "+this.color+"; font-family: "+this.kText.getFontFamily()+"; font-size: "+this.kText.getFontSize()+"pt; white-space: pre-wrap; word-wrap: break-word; overflow:hidden; resize:true;"}),this.handlerBlur=MM.Class.bind(MM.render,MM.render.editar),this.handlerKeyUp=MM.Class.bind(this,this.setTamanoEditor),this.editor.addEventListener("blur",this.handlerBlur),this.editor.addEventListener("keyup",this.handlerKeyUp),this.escenario.content.appendChild(this.editor),this.editor.select(),this.editor.focus(),a=b=c=d=null},cerrarEdicion:function(){this.editor.removeEventListener("blur",this.handlerBlur),this.editor.removeEventListener("keyup",this.handlerKeyUp),this.arbol.elemento.texto!==this.editor.value&&MM.undoManager.add(new MM.comandos.Editar(this.arbol.elemento.id,this.arbol.elemento.texto,this.editor.value)),this.arbol.elemento.texto=this.editor.value,this.setText(this.editor.value);var a=this.kText.getWidth(),b=this.kText.getHeight();this.group.setWidth(a),this.group.setHeight(b),this.rect.setPoints([{x:0,y:0},{x:a+17,y:0},{x:a+17,y:b},{x:0,y:b}]);var c=10,d=a+5,e=(b-c)/2;this.triangle.setPoints(this.arbol.elemento.plegado?[d,e,d+c,e,d+.5*c,e+c]:[d,e,d,e+c,d+c,e+.5*c]),this.editor.remove(),delete this.editor,MM.ponerFoco(this.arbol),MM.render.dibujar(MM.arbol),window.focus(),c=d=e=a=b=null},calcularFilasColumnas:function(a){var b=a.split("\n"),c=0,d=b.length;return b.forEach(function(a){a.length>c&&(c=a.length)}),b=null,{filas:d,columnas:c}},setTamanoEditor:function(){var a=this.calcularFilasColumnas(this.editor.value);this.editor.setAttribute("rows",a.filas),this.editor.setAttribute("cols",a.columnas),a=null},nop:function(){},destroy:function(){this.rect.destroy(),this.kText.destroy(),this.group.destroy(),delete this.kText,delete this.group}}),MM.Globo=MM.NodoSimple.extend({init:function(a,b,c){c.fontSize=12,this._super(a,b,c),this.line.hide(),this.rect.show()},ponerFoco:function(){this.rect.setStroke(this.colorFondo),this.rect.setFill(this.color),this.rect.setShadowColor(this.color),this.kText.setFill(this.colorFondo),this.triangle.setFill(this.colorFondo),this.group.draw()},quitarFoco:function(){this.rect.setStroke(this.color),this.rect.setFill(this.colorFondo),this.rect.setShadowColor(this.colorFondo),this.kText.setFill(this.color),this.triangle.setFill(this.color),this.group.draw()}}),MM.color={},MM.color.randomHslColor=function(){var a=function(a,b){return parseInt(Math.random()*(a-b+1),10)+b};return{h:a(1,360),s:a(30,100),l:a(20,50)}},MM.color.addBrillo=function(a,b){return b=b||0,{h:a.h,s:a.s,l:a.l+b}},MM.color.hslToCSS=function(a,b){return b=b||0,"hsl("+Math.floor(a.h)+","+Math.floor(a.s)+"%,"+Math.floor(a.l+b)+"%)"},MM.color.rgbToCSS=function(a){return"rgb("+Math.floor(a.r)+", "+Math.floor(a.g)+", "+Math.floor(a.b)+")"},MM.color.rgbToHexCSS=function(a){return"#"+MM.color.intToHex(a.r)+MM.color.intToHex(a.g)+MM.color.intToHex(a.b)},MM.color.intToHex=function(a,b){b=b||2;for(var c=Math.floor(a).toString(16);c.length<b;)c="0"+c;return c},MM.color.hue=function(a,b,c){var d=0;if(0!==c)switch(b){case a.r:d=(a.g-a.b)/c*60,0>d&&(d+=360);break;case a.g:d=(a.b-a.r)/c*60+120;break;case a.b:d=(a.r-a.g)/c*60+240}return d},MM.color.rgbToHsl=function(a){var b=Math.max(a.r,a.g,a.b),c=b-Math.min(a.r,a.g,a.b),d=b/255-c/510;return{h:MM.color.hue(a,b,c),s:0===c?0:c/2.55/(.5>d?2*d:2-2*d),l:100*d}},MM.color.hslToRgb=function(a){var b={r:2.55*a.l,g:2.55*a.l,b:2.55*a.l};if(0!==a.s){var c=a.l<50?a.l*(1+a.s/100):a.l+a.s-a.l*a.s/100,d=2*a.l-c;b={r:(a.h+120)/60%6,g:a.h/60,b:(a.h+240)/60%6};for(var e in b)b.hasOwnProperty(e)&&(b[e]=b[e]<1?d+(c-d)*b[e]:b[e]<3?c:b[e]<4?d+(c-d)*(4-b[e]):d,b[e]*=2.55)}return b},MM.Render=function(){var a=MM.Class.extend({init:function(a,b,c){this.contenedor=window.document.getElementById(a),this.width=this.contenedor.clientWidth-2,this.height=this.contenedor.clientHeight-2,this.devicePixelRatio=f(),this.Nodo=b||MM.Globo,this.Arista=c||MM.Arista,this.escenario=new Kinetic.Stage({container:a,width:this.width,height:this.height,draggable:!0,dragBoundFunc:function(a){return MM.render.offset=a,a}}),this.offset={x:0,y:0},this.capaGrid=new Kinetic.Layer,this.capaNodos=new Kinetic.Layer,this.capaAristas=new Kinetic.Layer,this.capaTransparencia=new Kinetic.Layer({visible:!1}),this.escenario.add(this.capaGrid),this.escenario.add(this.capaAristas),this.escenario.add(this.capaNodos),this.escenario.add(this.capaTransparencia)}});a.prototype.aristas=[],a.prototype.suscripciones=[],a.prototype.renderizar=function(){this.capaGrid.removeChildren(),new MM.Grid(this.capaGrid,this.width,this.height),this.dibujar(MM.arbol),this.suscribrirEventos(),MM.root(),MM.definirAtajos()};var b=function(a){return a.split("\n").length},c=function(a){return 35+15*(b(a.elemento.texto)-1)};a.prototype.calcularAlturas=function(a){var b=function(a){if(a.esHoja()||a.elemento.plegado)return c(a);var d=0;return a.hijos.forEach(function(a){d+=b(a)}),d},d=0;a.elemento.id===MM.arbol.elemento.id?(d=b(a),d=this.height<=d?d:this.height/this.getEscala()):d=a.elemento.reparto.y1-a.elemento.reparto.y0;var e=a.hijos.map(b),f=e.reduce(function(a,b){return a+b},0),g=(d-f)/a.hijos.length;return e=e.map(function(a){return a+g}),b=f=g=null,{padre:d,hijos:e}},a.prototype.dibujar=function(a){var b=a.suscribir("preOrden",MM.Class.bind(this,d)),c=a.suscribir("postPreOrden",MM.Class.bind(this,e));a.preOrden(),a.desSuscribir(b),a.desSuscribir(c),a=b=c=null,this.escenario.draw()};var d=function(a){this.repartoEspacio(a)},e=function(a){var b=a.elemento;a.hijos.forEach(function(c){var d=this.buscarArista(a,c);null===d?(d=new this.Arista(this.capaAristas,b,c.elemento,"3"),this.aristas.push(d)):this.aristas[d].redraw(),d=null},this),b=null};a.prototype.repartoEspacio=function(a){var b=a.elemento.reparto,c=this.calcularAlturas(a);a.elemento.id===MM.arbol.elemento.id&&(a.elemento.reparto=b={y0:0,y1:c.padre,xPadre:0,widthPadre:0},this.posicionarNodo(a));var d=b.y0,e=a.elemento.nodo.getWidth(),f=a.elemento.nodo.getX();a.hijos.forEach(function(a,b){a.elemento.reparto={y0:d,y1:d+c.hijos[b],xPadre:f,widthPadre:e},this.posicionarNodo(a),d+=c.hijos[b]},this),b=d=f=e=null},a.prototype.posicionarNodo=function(a){var b=a.elemento,d=b.reparto,e=!0,f=20;if(a.elemento.id!==MM.arbol.elemento.id){f=d.xPadre+d.widthPadre+75;var g=MM.arbol.padreDe(b.id);e=g?!(g.elemento.plegado&&a.elemento.plegado):!a.elemento.plegado}var h=d.y0+(d.y1-d.y0)/2-c(a)/2;null===b.nodo&&(b.nodo=new this.Nodo(this,a,{x:f,y:h,text:b.texto})),h=d.y0+(d.y1-d.y0)/2-b.nodo.getHeight()/2,b.nodo.setX(f),b.nodo.setY(h),b.nodo.setVisible(e),b=d=f=h=null},a.prototype.suscribrirEventos=function(){this.desuscribrirEventos();var a=this.suscripciones,b=MM.eventos;a.push(b.suscribir("ponerFoco",g)),a.push(b.suscribir("add",this.nuevoNodo,this)),a.push(b.suscribir("borrar",this.borrarNodo,this)),a.push(b.suscribir("nuevo/pre",function(){MM.arbol.elemento.nodo.destroy()})),a.push(b.suscribir("nuevo/post",function(){this.renderizar()},this)),this.contenedor.addEventListener("mousewheel",i,!1),this.contenedor.addEventListener("DOMMouseScroll",i,!1),a=b=null},a.prototype.desuscribrirEventos=function(){this.suscripciones.forEach(function(a){MM.eventos.desSuscribir(a)}),this.suscripciones=[],this.contenedor.removeEventListener("mousewheel",i),this.contenedor.removeEventListener("DOMMouseScroll",i)},a.prototype.renderAristas=function(){this.capaAristas&&(this.aristas.forEach(function(a){a.redraw()}),this.capaAristas.draw())},a.prototype.nuevoNodo=function(a,b){this.repartoEspacio(a),this.aristas.push(new this.Arista(this.capaAristas,a.elemento,b.elemento,"3")),this.dibujar(a),MM.ponerFoco(b)};var f=function(){return window.devicePixelRatio?window.devicePixelRatio:1};a.prototype.buscarArista=function(a,b){for(var c,d=0;d<this.aristas.length;d++)if(c=this.aristas[d],a.elemento.id===c.elementoOrigen.id&&b.elemento.id===c.elementoDestino.id)return d;return c=null,null},a.prototype.borrarArista=function(a,b){for(var c,d=0;d<this.aristas.length;d++)if(c=this.aristas[d],a.elemento.id===c.elementoOrigen.id&&b.elemento.id===c.elementoDestino.id)return c.destroy(),this.aristas.splice(d,1);return c=null,null},a.prototype.borrarHijo=function(a,b){for(var c=0;c<a.hijos.length;c++)if(a.hijos[c].elemento.id===b.elemento.id)return a.hijos.splice(c,1);return null},a.prototype.borrarNodo=function(a,b){for(var c=0;c<b.hijos.length;c)this.borrarNodo(b,b.hijos[c]);this.borrarArista(a,b),b.elemento.nodo.destroy(),this.borrarHijo(a,b),this.dibujar(a),c=null},a.prototype.getEscala=function(){var a=MM.render.escenario.getScale();return a.x},a.prototype.setEscala=function(a){MM.render.escenario.setScale({x:a,y:a}),MM.render.escenario.draw()},a.prototype.zoomIn=function(){var a=MM.render.getEscala();MM.render.setEscala(a+.05),MM.undoManager.add(new MM.comandos.Zoom(a,a+.05))},a.prototype.zoomOut=function(){var a=MM.render.getEscala();a>=.05&&(MM.render.setEscala(a-.05),MM.undoManager.add(new MM.comandos.Zoom(a,a-.05)))},a.prototype.zoomReset=function(){MM.render.setEscala(1),MM.undoManager.add(new MM.comandos.Zoom(MM.render.getEscala(),1))};var g=function(a,b){h&&MM.render.editar(),null!==a&&null!==a.elemento.nodo&&a.elemento.nodo.quitarFoco(),null!==b&&null!==b.elemento.nodo&&b.elemento.nodo.ponerFoco()},h=!1;a.prototype.editar=function(){var a=MM.render.capaTransparencia.canvas.element;h?(h=!1,a.style.background="transparent",a.style.opacity=0,a.style.display="none",MM.foco.elemento.nodo.cerrarEdicion()):(h=!0,MM.foco.elemento.nodo.editar(),a.style.background="white",a.style.opacity=.5,a.style.display="block"),MM.atajosEnEdicion(h),a=null},a.prototype.modoEdicion=function(){return h},a.prototype.insertarSaltoDeLinea=function(){if(h){var a=MM.foco.elemento.nodo.editor;a.value=a.value+"\n",MM.foco.elemento.nodo.setTamanoEditor(),a=null}};var i=function(a){var b=(a.wheelDelta||-a.detail)>0;b?MM.render.zoomIn():MM.render.zoomOut()};return a}(),"undefined"!=typeof module){var MM=require("./MindMapJS.js");MM.Class=require("./klass.js"),MM.PubSub=require("./pubsub.js")}MM.UndoManager=MM.Class.extend(function(){var a=[],b=10,c=-1,d=new MM.PubSub,e=function(a){b=a||10},f=function(b){g(),a.push(b),c=a.length-1,h(),d.on("add"),d.on("cambio")},g=function(){-1!==c&&c<a.length-1&&(a=a.slice(0,c+1))},h=function(){c===b&&(a.shift(),c--)},i=function(){a[c+1]&&(a[c+1].hacer(),k(),d.on("hacer"),d.on("cambio"))},j=function(){-1!==c&&(a[c].deshacer(),l(),d.on("deshacer"),d.on("cambio"))},k=function(){c<a.length-1&&(c++,d.on("avanzar"),d.on("cambio"))},l=function(){c>=0&&(c--,d.on("retroceder"),d.on("cambio"))},m=function(){return a[c+1]?a[c+1].nombre:null},n=function(){return-1!==c?a[c].nombre:null},o=function(){return a.map(function(a){return a.nombre})};return{init:e,nombres:o,hacerNombre:m,deshacerNombre:n,actual:function(){return c},add:f,hacer:i,deshacer:j,eventos:d}}()),MM.UndoManager.ComandoHacerDeshacer=MM.Class.extend({init:function(a,b,c){this.nombre=a,this.hacerCallBack=b,this.deshacerCallBack=c},hacer:function(){this.hacerCallBack()},deshacer:function(){this.deshacerCallBack()}}),"undefined"!=typeof module&&(module.exports.UndoManager=MM.UndoManager),MM.comandos={},MM.comandos.Insertar=MM.UndoManager.ComandoHacerDeshacer.extend({init:function(a,b,c){this._super("Añadir nuevo hijo "+c,function(){var d=MM.arbol.buscar(a),e=new MM.Arbol({id:b,texto:c,nodo:null});MM.ponerFoco(d),d.hijos.push(e),MM.eventos.on("add",d,e),d=e=null},function(){var c=MM.arbol.buscar(a),d=MM.arbol.buscar(b);MM.ponerFoco(c),MM.arbol.borrar(b),MM.eventos.on("borrar",c,d),c=d=null})}}),MM.comandos.Borrar=MM.UndoManager.ComandoHacerDeshacer.extend({init:function(a,b){var c=function(a){return new MM.Arbol({id:a.id,texto:a.texto,nodo:null})},d=function(a,b){a.hijos.push(b)},e=function(a){MM.render.repartoEspacio(a)},f=function(a){var b=a.elemento;a.hijos.forEach(function(c){if(null===MM.render.buscarArista(a,c)){var d=new MM.render.Arista(MM.render.capaAristas,b,c.elemento,"3");
MM.render.aristas.push(d),d=null}}),b=null},g=a.elemento.id,h=b.generalPreOrden(c,d);this._super("Borrar "+h.elemento.texto,function(){var a=MM.arbol.buscar(g);MM.ponerFoco(a);var b=MM.arbol.borrar(h.elemento.id);MM.eventos.on("borrar",a,b),a=b=null},function(){var a=MM.arbol.buscar(g);MM.ponerFoco(a);var b=h.generalPreOrden(c,d);if(a.hijos.push(b),MM.render){var i=a.suscribir("preOrden",e),j=a.suscribir("postPreOrden",f);a.preOrden(),a.desSuscribir(i),a.desSuscribir(j),i=j=null,MM.render.renderAristas(),MM.render.capaNodos.draw()}a=b=null})}}),MM.comandos.Nuevo=MM.UndoManager.ComandoHacerDeshacer.extend({init:function(){this._super("nuevo",function(){},function(){})}}),MM.comandos.Editar=MM.UndoManager.ComandoHacerDeshacer.extend({init:function(a,b,c){this._super("Editar "+b,function(){var b=MM.arbol.buscar(a);b.elemento.texto=c,b.elemento.nodo&&b.elemento.nodo.setText(c),b=null},function(){var c=MM.arbol.buscar(a);c.elemento.texto=b,c.elemento.nodo.setText(b),c=null})}}),MM.comandos.Zoom=MM.UndoManager.ComandoHacerDeshacer.extend({init:function(a,b){this._super("Zoom",function(){MM.render.setEscala(b)},function(){MM.render.setEscala(a)})}}),MM.comandos.Plegar=MM.UndoManager.ComandoHacerDeshacer.extend({init:function(a,b){this._super("Plegar",function(){MM.ponerFoco(a),MM.plegarRama(b,!0)},function(){MM.ponerFoco(a),MM.plegarRama(!b,!0)})}}),MM=function(a){var b=1;return a.undoManager=new MM.UndoManager(10),a.eventos=new MM.PubSub,MM.Arbol.prototype.elementEqual=function(a){return a===this.elemento.id},a.nuevo=function(a){if(this.arbol){this.ponerFoco(this.arbol);for(var c=0;c<this.arbol.hijos.length;c)this.next(),this.borrar();this.eventos.on("nuevo/pre")}b=1,this.arbol=this.foco=new MM.Arbol({id:b++,texto:a||"Idea Central",plegado:!1,nodo:null}),this.ponerFoco(this.arbol),this.eventos.on("nuevo/post")}.chain(),a.add=function(a){a=a||"Nueva idea";var c=new MM.Arbol({id:b++,texto:a,plegado:!1,nodo:null});this.foco.hijos.push(c),this.undoManager.add(new MM.comandos.Insertar(this.foco.elemento.id,c.elemento.id,a)),this.eventos.on("add",this.foco,c),c=null}.chain(),a.borrar=function(){if(this.arbol===this.foco)return void this.nuevo();var a=this.foco;this.padre(),this.arbol.borrar(a.elemento.id),this.undoManager.add(new MM.comandos.Borrar(this.foco,a)),this.eventos.on("borrar",this.foco,a),a=null}.chain(),a.next=function(){0!==this.foco.ordenNodo()&&(this.eventos.on("next",this.foco,this.foco.hijos[0]),this.ponerFoco(this.foco.hijos[0]))}.chain(),a.padre=function(){if(this.foco){var a=this.arbol.padreDe(this.foco.elemento.id);null!==a&&(this.eventos.on("padre",this.foco,a),this.ponerFoco(a)),a=null}}.chain(),a.nextHermano=function(){var a=this.arbol.padreDe(this.foco.elemento.id);if(null!==a){for(var b=0;b<a.hijos.length;b++)if(a.hijos[b].elementEqual(this.foco.elemento.id)){b===a.hijos.length-1?(this.eventos.on("nextHermano",this.foco,a.hijos[0]),this.ponerFoco(a.hijos[0])):(this.eventos.on("nextHermano",this.foco,a.hijos[b+1]),this.ponerFoco(a.hijos[b+1]));break}a=null}}.chain(),a.prevHermano=function(){var a=this.arbol.padreDe(this.foco.elemento.id);if(null!==a){for(var b=0;b<a.hijos.length;b++)if(a.hijos[b].elementEqual(this.foco.elemento.id))return void(0===b?(this.eventos.on("prevHermano",this.foco,a.hijos[a.hijos.length-1]),this.ponerFoco(a.hijos[a.hijos.length-1])):(this.eventos.on("prevHermano",this.foco,a.hijos[b-1]),this.ponerFoco(a.hijos[b-1])));a=null}}.chain(),a.lastHermano=function(){var a=this.arbol.padreDe(this.foco.elemento.id);null!==a&&(a.hijos.length>=1&&this.ponerFoco(a.hijos[a.hijos.length-1]),a=null)}.chain(),a.root=function(){this.eventos.on("root",this.foco,this.arbol),this.ponerFoco(this.arbol)}.chain(),a.ponerFoco=function(a){this.eventos.on("ponerFoco",this.foco,a),this.foco=a},a.nuevo("Idea Central"),a.render=null,a.renderizar=function(b,c,d){a.render=new MM.Render(b,c,d),a.render.renderizar()},a.plegarRama=function(a,b){a=a||!this.foco.elemento.plegado,this.foco.elemento.plegado=a;var c=function(a){a.hijos.forEach(function(a){a.elemento.plegado=!0,c(a)})},d=function(a){var b=a.elemento.plegado;a.hijos.forEach(function(a){a.elemento.plegado=!b&&a.esHoja()?!1:a.elemento.plegado,d(a)}),b=null};a?c(this.foco):d(this.foco),this.render.dibujar(MM.arbol),b||this.undoManager.add(new MM.comandos.Plegar(this.foco,a))},a.cargarFreeMind=function(){var a=new MM.importar.FreeMind,b=(MM.importar.evento.suscribir("freeMind/raiz",function(){MM.render.desuscribrirEventos()}),MM.importar.evento.suscribir("freeMind/procesado",function(){MM.render.renderizar()}),MM.DOM.create("input",{type:"file",id:"ficheros"}));b.addEventListener("change",function(){0!==b.files.length&&a.cargar(b.files[0])},!1),b.click()},a}(MM),MM.definirAtajos=function(){MM.teclado.atajos.add("Ctrl++",MM.render.zoomIn,MM),MM.teclado.atajos.add("Ctrl+-",MM.render.zoomOut,MM),MM.teclado.atajos.add("Ctrl+0",MM.render.zoomReset,MM);var a=function(){MM.foco.elemento.plegado&&MM.plegarRama(!1),MM.add(),MM.render.editar()};MM.teclado.atajos.add("Shift+n",MM.nuevo,MM),MM.teclado.atajos.add("ins",a,MM),MM.teclado.atajos.add("Shift+Tab",a,MM),MM.teclado.atajos.add("del",MM.borrar,MM),MM.teclado.atajos.add("Shift+Enter",function(){MM.render.modoEdicion()?MM.render.insertarSaltoDeLinea():(MM.padre().add(),MM.render.editar())},MM),MM.teclado.atajos.add("enter",MM.render.editar,MM),MM.teclado.atajos.add("esc",function(){MM.render.modoEdicion()&&MM.render.editar()},MM),MM.teclado.atajos.add("shift++",function(){MM.plegarRama(!1)},MM),MM.teclado.atajos.add("shift+-",function(){MM.plegarRama(!0)},MM),MM.teclado.atajos.add("home",MM.root,MM),MM.teclado.atajos.add("left",MM.padre,MM),MM.teclado.atajos.add("right",MM.next,MM),MM.teclado.atajos.add("up",MM.prevHermano,MM),MM.teclado.atajos.add("down",MM.nextHermano,MM),MM.teclado.atajos.add("tab",function(){MM.render.modoEdicion()?MM.render.editar():(MM.foco.esHoja()&&a(),MM.foco.elemento.plegado?MM.plegarRama(!1):MM.next())},MM)},MM.atajosEnEdicion=function(a){MM.teclado.atajos.activar("Ctrl++",!a),MM.teclado.atajos.activar("Ctrl+-",!a),MM.teclado.atajos.activar("Ctrl+0",!a),MM.teclado.atajos.activar("Shift+n",!a),MM.teclado.atajos.activar("ins",!a),MM.teclado.atajos.activar("Shift+Tab",!a),MM.teclado.atajos.activar("del",!a),MM.teclado.atajos.activar("shift++",!a),MM.teclado.atajos.activar("shift+-",!a),MM.teclado.atajos.activar("home",!a),MM.teclado.atajos.activar("left",!a),MM.teclado.atajos.activar("right",!a),MM.teclado.atajos.activar("up",!a),MM.teclado.atajos.activar("down",!a)},MM.demo={},MM.demo.timerDeslizador=null,MM.demo.deslizar=function(a,b){var c="-500px",d="25px",e=document.getElementById(a);b=b||[],e.style.top===d?e.style.top=c:(e.style.top===c||""===e.style.top)&&(b.forEach(function(a){document.getElementById(a).style.top=c}),e.style.top=d,MM.demo.timerDeslizador&&window.clearTimeout(MM.demo.timerDeslizador),MM.demo.timerDeslizador=window.setTimeout(function(){e.style.top===d&&(e.style.top=c)},5e3))},MM.demo.ayuda=function(){MM.demo.deslizar("ayuda",["datosDelProyecto"])},MM.demo.datosDelProyecto=function(){MM.demo.deslizar("datosDelProyecto",["ayuda"])},MM.demo.hacer=function(){MM.undoManager.hacer()},MM.demo.deshacer=function(){MM.undoManager.deshacer()},MM.demo.cambioUndoManager=function(){var a=document.getElementById("btnHacer"),b=document.getElementById("btnDeshacer"),c=document.getElementById("iconHacer"),d=document.getElementById("iconDeshacer");null===MM.undoManager.hacerNombre()?(a.setAttribute("disabled","disabled"),a.setAttribute("title",""),c.setAttribute("style","color: #ddd;")):(a.hasAttribute("disabled")&&(a.removeAttribute("disabled"),c.removeAttribute("style")),a.setAttribute("title","Hacer "+MM.undoManager.hacerNombre())),null===MM.undoManager.deshacerNombre()?(b.setAttribute("disabled","disabled"),b.setAttribute("title",""),d.setAttribute("style","color: #ddd;")):(b.hasAttribute("disabled")&&(b.removeAttribute("disabled"),d.removeAttribute("style")),b.setAttribute("title","Deshacer "+MM.undoManager.deshacerNombre())),a=b=null},MM.demo.mmAyuda=function(){MM.nuevo("Como usar MindMapJS").add("Teclado").add("Ratón").add("Tablet"),MM.next(),MM.add("Zoom").add("Navegación").add("Plegado").add("Edición").add("Operaciones"),MM.next(),MM.add("<< Ctrl++ >> In").add("<< Ctrl+- >> Out").add("<< Ctrl+0 >> Reset"),MM.nextHermano(),MM.add("<< Home >> Ir a Idea Central").add("<< Cursores >> Cambiar de nodo").add("<< Tab >> Siguiente nivel"),MM.nextHermano(),MM.add("<< Shift++ >>Desplegar").add("<< Shift+- >> Plegar"),MM.nextHermano(),MM.add("<< Enter >> Entrar/salir del modo de Edición").add("<< Escape >> Salir de Edición").add("<< Tab >> Salir del Edición"),MM.nextHermano(),MM.add("<< Shift+n >> Nuevo Mapa Mental").add("<< Ins >> Nuevo hijo").add("<< Shift+Tab >> Nuevo hijo").add("<< del >> Borrar").add("<< Shift+Enter >> Nuevo hermano / Salto de línea"),MM.root().next().nextHermano().add("Click").add("Doble Click").add("Arrastrar"),MM.next(),MM.add("Seleccionar Idea").add("Plegar/Desplegar"),MM.nextHermano(),MM.add("Editar"),MM.nextHermano(),MM.add("Mover el escenario").add("Mover nodo"),MM.root().next().nextHermano().nextHermano().add("Touch").add("Doble touch").add("Arrastrar"),MM.next(),MM.add("Seleccionar Idea"),MM.nextHermano(),MM.add("Editar"),MM.nextHermano(),MM.add("Mover el escenario").add("Mover nodo"),MM.renderizar("contenedorEditor"),MM.undoManager.eventos.suscribir("cambio",MM.demo.cambioUndoManager),MM.demo.cambioUndoManager(),window.addEventListener("resize",function(){console.log("resize 0"),MM.render.escenario.setHeight(this.innerHeight),MM.render.escenario.setWidth(this.innerWidth),window.setTimeout(MM.render.escenario.draw,500),console.log("resize 1")},!1)};